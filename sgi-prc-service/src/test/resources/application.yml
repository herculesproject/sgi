sgi:
  time-zone: "Europe/Madrid"
  web-url: "http://sgi.crue.com"
  rest:
    api:
      cnf-url: "http://sgi-cnf-service:4288"
      com-url: "http://sgi-com-service:4286"
      csp-url: "http://sgi-csp-service:4281"
      pii-url: "http://sgi-pii-service:4283"
      rel-url: "http://sgi-rel-service:4284"
      rep-url: "http://sgi-rep-service:4287"
      sgo-url: "http:/sgi-esb:8080/sgo"
      sgepii-url: "http://sgi-esb:8080/sgepii"
      sgp-url: "http://sgi-esb:8080/sgp"
      tp-url:  "http://sgi-tp-service:4285"

spring:
  datasource:
    # We use a H2 in file database with PostgreSQL compatibility mode
    url: "jdbc:h2:mem:test;NON_KEYWORDS=VALUE;DB_CLOSE_DELAY=-1"
    driver-class-name: org.h2.Driver
    username: prc
    password: prc
  # H2 console
  h2:
    console:
      enabled: false
  jpa:
    hibernate:
      # Make sure Hibernate will not use the entities to create, update or validate the database
      # validate | update | create | create-drop
      ddl-auto: none
    # Disable Open Session In View
    open-in-view: false
    # Extra Hibernate properties
    properties:
      hibernate:
        # We use a H2 database with PostgreSQL compatibility mode
        dialect: org.hibernate.dialect.H2Dialect
        # Set default Hibernate schema
        '[default_schema]': test
        jdbc:
          # see: https://vladmihalcea.com/how-to-store-date-time-and-timestamps-in-utc-time-zone-with-jdbc-and-hibernate/
          '[time_zone]': UTC
  liquibase:
    # No Liquibase contexts
    contexts: test
    # Default database schema
    default-schema: ${spring.jpa.properties.hibernate.[default_schema]}
    # Enable Liquibase
    enabled: true
    # Schema to use for Liquibase objects
    liquibase-schema: ${spring.jpa.properties.hibernate.[default_schema]}
    # Set Liquibase changeLog parameters
    parameters:
      schemaPrefix: ${spring.jpa.properties.hibernate.[default_schema]}.
  mvc:
    # Retain ant path controller definitions
    pathmatch:
      matching-strategy: ant-path-matcher
    # Whether a "NoHandlerFoundException" should be thrown if no Handler was found to process a request
    throw-exception-if-no-handler-found: true
  security:
    oauth2:
      client:
        registration:
          # "sgi" is the id used inside the redirect-uri-template, must be the same as your realm
          sgi:
            authorization-grant-type: authorization_code
            client-id: front
            client-name: SGI (user login)
            provider: keycloak
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope: "openid,profile"
          prc-service:
            authorization-grant-type: client_credentials
            client-id: prc-service
            client-name: SGI (service login)
            client-secret: a57a856d-5136-42d9-8baa-6e2bdb962a2e
            provider: keycloak
            scope: sgi-cnf,sgi-com,sgi-csp,sgi-pii,sgi-rel,sgi-rep,sgi-sgepii,sgi-sgo,sgi-sgp,sgi-tp          
        provider:
          keycloak:
            issuer-uri: http://sgi-auth:8080/auth/realms/sgi
            user-name-attribute: user_ref_id
      resourceserver:
        jwt:
          # JSON Web Key endpoint (with the cryptographic key to validate JSON Web Signature)
          jwk-set-uri: ${spring.security.oauth2.client.provider.keycloak.issuer-uri}/protocol/openid-connect/certs
          user-name-claim: preferred_username
  web:
    resources:
      # Disable the static resource handling
      add-mappings: false
  test:
    database:
      # By default, tests annotated with @DataJpaTest will use an embedded in-memory database (replacing any explicit or usually auto-configured DataSource).
      replace: none

preliquibase:
  enabled: true
---
spring:
  config:
    activate:
      on-profile:
      - test-postgres
  datasource:
    # We use PostgreSQL database
    url: "jdbc:postgresql://postgres:5432/db"
    driver-class-name: org.postgresql.Driver
    username: postgres
    password: admin
  jpa:
    properties:
      hibernate:
        # We use a PostgreSQL database
        dialect: org.hibernate.dialect.PostgreSQL10Dialect
